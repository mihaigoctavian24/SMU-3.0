@* RecentActivityList.razor - Reusable activity list component for dashboards using Radzen *@

<RadzenCard Style="padding: 0; overflow: hidden;">
    <RadzenStack Orientation="Radzen.Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center"
                 Class="rz-p-4" Style="border-bottom: 1px solid var(--rz-base-300);">
        <RadzenText TextStyle="TextStyle.H6" Style="margin: 0; font-weight: 600;">@Title</RadzenText>
        @if (!string.IsNullOrEmpty(ViewAllLink))
        {
            <RadzenLink Path="@ViewAllLink" Text="Vezi toate" Style="font-weight: 500;" />
        }
    </RadzenStack>

    @if (Items == null || !Items.Any())
    {
        <RadzenStack AlignItems="AlignItems.Center" JustifyContent="JustifyContent.Center" Class="rz-p-6" Gap="0.75rem">
            <RadzenIcon Icon="inbox" Style="font-size: 48px; color: var(--rz-text-disabled-color);" />
            <RadzenText TextStyle="TextStyle.Body2" class="rz-color-secondary" Style="margin: 0;">@EmptyMessage</RadzenText>
        </RadzenStack>
    }
    else
    {
        <RadzenStack Gap="0">
            @foreach (var item in Items.Take(MaxItems))
            {
                <RadzenStack Orientation="Radzen.Orientation.Horizontal" AlignItems="AlignItems.Start" Gap="1rem"
                             Class="rz-p-4" Style="border-bottom: 1px solid var(--rz-base-200);">
                    @if (item.IconContent != null)
                    {
                        @item.IconContent
                    }
                    else
                    {
                        <RadzenStack AlignItems="AlignItems.Center" JustifyContent="JustifyContent.Center"
                                     Style="@($"width: 40px; height: 40px; border-radius: 50%; background: {GetIconBg(item.Type)}; flex-shrink: 0;")">
                            <RadzenIcon Icon="@GetMaterialIcon(item.Type)" Style="@($"font-size: 20px; color: {GetIconColor(item.Type)};")" />
                        </RadzenStack>
                    }
                    <RadzenStack Gap="0.25rem" Style="flex: 1; min-width: 0;">
                        <RadzenStack Orientation="Radzen.Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                            <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                @item.Title
                            </RadzenText>
                            @if (!string.IsNullOrEmpty(item.Badge))
                            {
                                <RadzenBadge BadgeStyle="@GetBadgeStyle(item.BadgeType)" Text="@item.Badge" IsPill="true" />
                            }
                        </RadzenStack>
                        @if (!string.IsNullOrEmpty(item.Description))
                        {
                            <RadzenText TextStyle="TextStyle.Caption" class="rz-color-secondary"
                                        Style="margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                @item.Description
                            </RadzenText>
                        }
                        @if (item.Timestamp.HasValue)
                        {
                            <RadzenText TextStyle="TextStyle.Caption" Style="margin: 0; color: var(--rz-text-disabled-color);">
                                @FormatTimestamp(item.Timestamp.Value)
                            </RadzenText>
                        }
                    </RadzenStack>
                    @if (!string.IsNullOrEmpty(item.ActionLink))
                    {
                        <RadzenLink Path="@item.ActionLink" Style="flex-shrink: 0;">
                            <RadzenIcon Icon="chevron_right" Style="font-size: 20px;" />
                        </RadzenLink>
                    }
                </RadzenStack>
            }
        </RadzenStack>
    }
</RadzenCard>

@code {
    [Parameter] public string Title { get; set; } = "Activitate recentă";
    [Parameter] public List<ActivityItem>? Items { get; set; }
    [Parameter] public string? ViewAllLink { get; set; }
    [Parameter] public int MaxItems { get; set; } = 5;
    [Parameter] public string EmptyMessage { get; set; } = "Nu există activitate recentă";

    public class ActivityItem
    {
        public string Title { get; set; } = "";
        public string? Description { get; set; }
        public DateTime? Timestamp { get; set; }
        public string Type { get; set; } = "default"; // grade, attendance, document, notification, user, course
        public string? Badge { get; set; }
        public string BadgeType { get; set; } = "default"; // success, warning, danger, info, default
        public string? ActionLink { get; set; }
        public RenderFragment? IconContent { get; set; }
    }

    private string GetMaterialIcon(string type) => type switch
    {
        "grade" => "assignment",
        "attendance" => "check_circle",
        "document" => "description",
        "notification" => "notifications",
        "user" => "person",
        "course" => "menu_book",
        "warning" => "warning",
        _ => "info"
    };

    private string GetIconBg(string type) => type switch
    {
        "grade" => "rgba(34, 197, 94, 0.15)",
        "attendance" => "rgba(79, 70, 229, 0.15)",
        "document" => "rgba(245, 158, 11, 0.15)",
        "notification" => "rgba(59, 130, 246, 0.15)",
        "user" => "rgba(168, 85, 247, 0.15)",
        "course" => "rgba(99, 102, 241, 0.15)",
        "warning" => "rgba(239, 68, 68, 0.15)",
        _ => "rgba(107, 114, 128, 0.15)"
    };

    private string GetIconColor(string type) => type switch
    {
        "grade" => "var(--rz-success)",
        "attendance" => "var(--rz-primary)",
        "document" => "var(--rz-warning)",
        "notification" => "var(--rz-info)",
        "user" => "#a855f7",
        "course" => "#6366f1",
        "warning" => "var(--rz-danger)",
        _ => "var(--rz-text-secondary-color)"
    };

    private BadgeStyle GetBadgeStyle(string badgeType) => badgeType switch
    {
        "success" => BadgeStyle.Success,
        "warning" => BadgeStyle.Warning,
        "danger" => BadgeStyle.Danger,
        "info" => BadgeStyle.Info,
        _ => BadgeStyle.Light
    };

    private string FormatTimestamp(DateTime timestamp)
    {
        var diff = DateTime.Now - timestamp;
        if (diff.TotalMinutes < 1) return "Acum";
        if (diff.TotalMinutes < 60) return $"Acum {(int)diff.TotalMinutes} min";
        if (diff.TotalHours < 24) return $"Acum {(int)diff.TotalHours} ore";
        if (diff.TotalDays < 7) return $"Acum {(int)diff.TotalDays} zile";
        return timestamp.ToString("dd MMM yyyy");
    }
}
