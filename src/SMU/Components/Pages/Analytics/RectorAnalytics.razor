@page "/analytics/university"
@using SMU.Services
@using SMU.Components.Shared.Charts
@using Microsoft.AspNetCore.Authorization
@inject IAnalyticsService AnalyticsService
@attribute [Authorize(Roles = "Rector,Admin")]

<PageTitle>Dashboard Universitate | SMU</PageTitle>

<RadzenStack Gap="1.5rem">
    <!-- Header Section -->
    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
        <RadzenStack Gap="0.25rem">
            <RadzenText TextStyle="TextStyle.H3" Style="margin: 0; font-weight: bold;">Dashboard Universitate</RadzenText>
            <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: var(--rz-text-secondary-color);">
                Analiza KPI-uri la nivel universitar - An Academic @currentAcademicYear
            </RadzenText>
        </RadzenStack>
        <RadzenButton Text="Export PDF"
                      Icon="download"
                      ButtonStyle="ButtonStyle.Light"
                      Click="@ExportToPdf" />
    </RadzenStack>

    <!-- Loading State -->
    @if (isLoading)
    {
        <RadzenStack AlignItems="AlignItems.Center" JustifyContent="JustifyContent.Center" Style="min-height: 400px;">
            <RadzenProgressBarCircular ShowValue="false" Mode="ProgressBarMode.Indeterminate" Size="ProgressBarCircularSize.Large" />
            <RadzenText TextStyle="TextStyle.Body1" Style="margin-top: 1rem; color: var(--rz-text-secondary-color);">Se incarca datele universitare...</RadzenText>
        </RadzenStack>
    }
    else if (!hasData)
    {
        <RadzenAlert AlertStyle="AlertStyle.Warning" Variant="Variant.Flat" ShowIcon="true" Size="AlertSize.Large">
            <RadzenStack AlignItems="AlignItems.Center" Gap="0.5rem">
                <RadzenText TextStyle="TextStyle.H6" Style="margin: 0;">Nu exista date universitare</RadzenText>
                <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0;">
                    Nu au fost gasite date despre facultati sau studenti in sistem.
                    Contactati administratorul pentru a verifica configurarea bazei de date.
                </RadzenText>
            </RadzenStack>
        </RadzenAlert>
    }
    else
    {
        <!-- University KPI Cards (6 cards, 2 rows of 3) -->
        <RadzenRow Gap="1.5rem" RowGap="1.5rem">
            <!-- Total Students -->
            <RadzenColumn Size="12" SizeMD="6" SizeLG="4">
                <RadzenCard Style="padding: 1.5rem; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border: 1px solid #93c5fd;">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                        <RadzenStack Gap="0.5rem">
                            <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: #2563eb; font-weight: 500;">Total Studenti Activi</RadzenText>
                            <RadzenText TextStyle="TextStyle.H3" Style="margin: 0; color: #1e3a8a; font-weight: bold;">@universityStats.TotalStudents.ToString("N0")</RadzenText>
                        </RadzenStack>
                        <div style="width: 3.5rem; height: 3.5rem; background: #93c5fd; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <RadzenIcon Icon="people" Style="font-size: 1.75rem; color: #2563eb;" />
                        </div>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>

            <!-- Total Professors -->
            <RadzenColumn Size="12" SizeMD="6" SizeLG="4">
                <RadzenCard Style="padding: 1.5rem; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border: 1px solid #6ee7b7;">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                        <RadzenStack Gap="0.5rem">
                            <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: #059669; font-weight: 500;">Total Profesori</RadzenText>
                            <RadzenText TextStyle="TextStyle.H3" Style="margin: 0; color: #065f46; font-weight: bold;">@universityStats.TotalProfessors.ToString("N0")</RadzenText>
                        </RadzenStack>
                        <div style="width: 3.5rem; height: 3.5rem; background: #6ee7b7; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <RadzenIcon Icon="school" Style="font-size: 1.75rem; color: #059669;" />
                        </div>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>

            <!-- Faculty Count -->
            <RadzenColumn Size="12" SizeMD="6" SizeLG="4">
                <RadzenCard Style="padding: 1.5rem; background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); border: 1px solid #c4b5fd;">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                        <RadzenStack Gap="0.5rem">
                            <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: #7c3aed; font-weight: 500;">Numar Facultati</RadzenText>
                            <RadzenText TextStyle="TextStyle.H3" Style="margin: 0; color: #4c1d95; font-weight: bold;">@universityStats.FacultyCount.ToString("N0")</RadzenText>
                        </RadzenStack>
                        <div style="width: 3.5rem; height: 3.5rem; background: #c4b5fd; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <RadzenIcon Icon="apartment" Style="font-size: 1.75rem; color: #7c3aed;" />
                        </div>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>

            <!-- Overall Average Grade -->
            <RadzenColumn Size="12" SizeMD="6" SizeLG="4">
                <RadzenCard Style="padding: 1.5rem; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 1px solid #fcd34d;">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                        <RadzenStack Gap="0.5rem">
                            <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: #d97706; font-weight: 500;">Media Generala Universitate</RadzenText>
                            <RadzenText TextStyle="TextStyle.H3" Style="margin: 0; color: #92400e; font-weight: bold;">@universityStats.OverallAverage.ToString("F2")</RadzenText>
                        </RadzenStack>
                        <div style="width: 3.5rem; height: 3.5rem; background: #fcd34d; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <RadzenIcon Icon="grade" Style="font-size: 1.75rem; color: #d97706;" />
                        </div>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>

            <!-- Pass Rate -->
            <RadzenColumn Size="12" SizeMD="6" SizeLG="4">
                <RadzenCard Style="padding: 1.5rem; background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border: 1px solid #86efac;">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                        <RadzenStack Gap="0.5rem">
                            <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: #16a34a; font-weight: 500;">Rata Promovare Globala</RadzenText>
                            <RadzenText TextStyle="TextStyle.H3" Style="margin: 0; color: #14532d; font-weight: bold;">@universityStats.PassRate.ToString("F1")%</RadzenText>
                        </RadzenStack>
                        <div style="width: 3.5rem; height: 3.5rem; background: #86efac; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <RadzenIcon Icon="check_circle" Style="font-size: 1.75rem; color: #16a34a;" />
                        </div>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>

            <!-- Total Programs -->
            <RadzenColumn Size="12" SizeMD="6" SizeLG="4">
                <RadzenCard Style="padding: 1.5rem; background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); border: 1px solid #a5b4fc;">
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                        <RadzenStack Gap="0.5rem">
                            <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: #4f46e5; font-weight: 500;">Total Programe Studiu</RadzenText>
                            <RadzenText TextStyle="TextStyle.H3" Style="margin: 0; color: #312e81; font-weight: bold;">@totalPrograms.ToString("N0")</RadzenText>
                        </RadzenStack>
                        <div style="width: 3.5rem; height: 3.5rem; background: #a5b4fc; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <RadzenIcon Icon="menu_book" Style="font-size: 1.75rem; color: #4f46e5;" />
                        </div>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>
        </RadzenRow>

        <!-- Faculty Comparison Section (Full Width) -->
        <RadzenCard Style="padding: 1.5rem;">
            <RadzenStack Gap="1.5rem">
                <RadzenText TextStyle="TextStyle.H5" Style="margin: 0; font-weight: 600;">Comparatie Facultati - Media</RadzenText>

                <!-- Bar Chart with Trends -->
                <SmuBarChart
                    Title="Media Academica per Facultate"
                    Data="facultyAverageChartData"
                    YAxisLabel="Media Note"
                    Height="400"
                    Horizontal="true"
                    IsLoading="isLoading" />

                <!-- Trend Indicators -->
                <RadzenRow Gap="1rem" RowGap="0.75rem">
                    @foreach (var faculty in facultyComparisons)
                    {
                        <RadzenColumn Size="6" SizeMD="3">
                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; font-weight: 500;">@faculty.FacultyCode:</RadzenText>
                                @if (faculty.Trend == "ascending")
                                {
                                    <RadzenIcon Icon="trending_up" Style="color: var(--rz-success);" />
                                    <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: var(--rz-success);">Crestere</RadzenText>
                                }
                                else if (faculty.Trend == "descending")
                                {
                                    <RadzenIcon Icon="trending_down" Style="color: var(--rz-danger);" />
                                    <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: var(--rz-danger);">Scadere</RadzenText>
                                }
                                else
                                {
                                    <RadzenIcon Icon="trending_flat" Style="color: var(--rz-text-secondary-color);" />
                                    <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: var(--rz-text-secondary-color);">Stabil</RadzenText>
                                }
                            </RadzenStack>
                        </RadzenColumn>
                    }
                </RadzenRow>
            </RadzenStack>
        </RadzenCard>

        <!-- Charts Row (2 columns) -->
        <RadzenRow Gap="1.5rem" RowGap="1.5rem">
            <RadzenColumn Size="12" SizeLG="6">
                <RadzenCard Style="padding: 1.5rem; height: 100%;">
                    <SmuDonutChart
                        Title="Distributie Studenti per Facultate"
                        Data="studentDistributionData"
                        Height="400"
                        ShowLegend="true"
                        IsLoading="isLoading" />
                </RadzenCard>
            </RadzenColumn>

            <RadzenColumn Size="12" SizeLG="6">
                <RadzenCard Style="padding: 1.5rem; height: 100%;">
                    <SmuRadarChart
                        Title="Metrici Comparative Facultati"
                        Data="facultyMetricsData"
                        Height="400"
                        IsLoading="isLoading" />
                </RadzenCard>
            </RadzenColumn>
        </RadzenRow>

        <!-- Trends Section (Full Width) -->
        <RadzenCard Style="padding: 1.5rem;">
            <RadzenStack Gap="1.5rem">
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                    <RadzenText TextStyle="TextStyle.H5" Style="margin: 0; font-weight: 600;">Evolutie Indicatori Universitari</RadzenText>
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                        <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: var(--rz-text-secondary-color);">Perioada:</RadzenText>
                        <RadzenDropDown @bind-Value="selectedMonthRange"
                                        Change="@LoadTrendData"
                                        Data="@monthRangeOptions"
                                        TextProperty="Text"
                                        ValueProperty="Value"
                                        Style="width: 180px;" />
                    </RadzenStack>
                </RadzenStack>

                <!-- Multi-line Chart -->
                <RadzenStack Gap="1.5rem">
                    <SmuLineChart
                        Title="Total Studenti (Evolutie)"
                        Data="studentsTrendData"
                        YAxisLabel="Numar Studenti"
                        Height="300"
                        IsLoading="isLoading" />

                    <SmuLineChart
                        Title="Media Generala (Evolutie)"
                        Data="averageGradeTrendData"
                        YAxisLabel="Media Note"
                        Height="300"
                        IsLoading="isLoading" />

                    <SmuLineChart
                        Title="Rata Promovare (Evolutie)"
                        Data="passRateTrendData"
                        YAxisLabel="Procent (%)"
                        Height="300"
                        IsLoading="isLoading" />
                </RadzenStack>
            </RadzenStack>
        </RadzenCard>

        <!-- Quick Summary Table -->
        <RadzenCard Style="padding: 0; overflow: hidden;">
            <div style="padding: 1rem 1.5rem; border-bottom: 1px solid var(--rz-border-color);">
                <RadzenText TextStyle="TextStyle.H5" Style="margin: 0; font-weight: 600;">Sinteza Facultati</RadzenText>
            </div>
            <RadzenDataGrid Data="@GetSortedFaculties()" TItem="FacultyComparisonDto" AllowSorting="true" Style="border: none;">
                <Columns>
                    <RadzenDataGridColumn TItem="FacultyComparisonDto" Property="FacultyName" Title="Facultate" Width="250px">
                        <Template Context="faculty">
                            <RadzenStack Gap="0.125rem">
                                <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; font-weight: 500;">@faculty.FacultyName</RadzenText>
                                <RadzenText TextStyle="TextStyle.Caption" Style="margin: 0; color: var(--rz-text-secondary-color);">@faculty.FacultyCode</RadzenText>
                            </RadzenStack>
                        </Template>
                    </RadzenDataGridColumn>

                    <RadzenDataGridColumn TItem="FacultyComparisonDto" Property="StudentCount" Title="Studenti" Width="120px">
                        <Template Context="faculty">
                            <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0;">@faculty.StudentCount.ToString("N0")</RadzenText>
                        </Template>
                    </RadzenDataGridColumn>

                    <RadzenDataGridColumn TItem="FacultyComparisonDto" Title="Profesori" Width="120px" Sortable="false">
                        <Template Context="faculty">
                            <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0;">@GetProfessorCount(faculty.FacultyCode).ToString("N0")</RadzenText>
                        </Template>
                    </RadzenDataGridColumn>

                    <RadzenDataGridColumn TItem="FacultyComparisonDto" Property="AverageGrade" Title="Media" Width="100px">
                        <Template Context="faculty">
                            <RadzenBadge BadgeStyle="@GetGradeBadgeStyle(faculty.AverageGrade)"
                                         Text="@faculty.AverageGrade.ToString("F2")"
                                         IsPill="true" />
                        </Template>
                    </RadzenDataGridColumn>

                    <RadzenDataGridColumn TItem="FacultyComparisonDto" Property="PassRate" Title="Promovare" Width="120px">
                        <Template Context="faculty">
                            <RadzenBadge BadgeStyle="@GetPassRateBadgeStyle(faculty.PassRate)"
                                         Text="@($"{faculty.PassRate:F1}%")"
                                         IsPill="true" />
                        </Template>
                    </RadzenDataGridColumn>

                    <RadzenDataGridColumn TItem="FacultyComparisonDto" Property="Trend" Title="Trend" Width="120px">
                        <Template Context="faculty">
                            @if (faculty.Trend == "ascending")
                            {
                                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem">
                                    <RadzenIcon Icon="trending_up" Style="color: var(--rz-success);" />
                                    <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: var(--rz-success);">Pozitiv</RadzenText>
                                </RadzenStack>
                            }
                            else if (faculty.Trend == "descending")
                            {
                                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem">
                                    <RadzenIcon Icon="trending_down" Style="color: var(--rz-danger);" />
                                    <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: var(--rz-danger);">Negativ</RadzenText>
                                </RadzenStack>
                            }
                            else
                            {
                                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.25rem">
                                    <RadzenIcon Icon="trending_flat" Style="color: var(--rz-text-secondary-color);" />
                                    <RadzenText TextStyle="TextStyle.Body2" Style="margin: 0; color: var(--rz-text-secondary-color);">Stabil</RadzenText>
                                </RadzenStack>
                            }
                        </Template>
                    </RadzenDataGridColumn>
                </Columns>
            </RadzenDataGrid>
        </RadzenCard>
    }
</RadzenStack>

@code {
    private bool isLoading = true;
    private bool hasData = false;
    private string currentAcademicYear = "2024-2025";
    private int selectedMonthRange = 6;
    private string sortColumn = "students";
    private bool sortAscending = false;

    // University Statistics
    private UniversityAnalyticsDto universityStats = new();
    private List<FacultyComparisonDto> facultyComparisons = new();
    private TrendDataDto trendData = new();
    private int totalPrograms = 0;

    // Chart Data
    private List<SmuBarChart.ChartDataItem> facultyAverageChartData = new();
    private List<SmuDonutChart.ChartDataSegment> studentDistributionData = new();
    private List<SmuRadarChart.ChartDataCategory> facultyMetricsData = new();
    private List<SmuLineChart.ChartDataPoint> studentsTrendData = new();
    private List<SmuLineChart.ChartDataPoint> averageGradeTrendData = new();
    private List<SmuLineChart.ChartDataPoint> passRateTrendData = new();

    // Dropdown options
    private List<MonthRangeOption> monthRangeOptions = new()
    {
        new() { Value = 6, Text = "Ultimele 6 luni" },
        new() { Value = 12, Text = "Ultimele 12 luni" }
    };

    private class MonthRangeOption
    {
        public int Value { get; set; }
        public string Text { get; set; } = "";
    }

    protected override async Task OnInitializedAsync()
    {
        await LoadAllData();
    }

    private async Task LoadAllData()
    {
        isLoading = true;
        hasData = false;

        try
        {
            // Load university-wide statistics
            universityStats = await AnalyticsService.GetUniversityStatsAsync();
            facultyComparisons = await AnalyticsService.GetFacultyComparisonsAsync();

            // Check if we have actual data
            hasData = universityStats.TotalStudents > 0 || universityStats.FacultyCount > 0 || facultyComparisons.Any();

            if (hasData)
            {
                await LoadTrendData();

                // Use real program count from stats
                totalPrograms = universityStats.ProgramCount;

                // Prepare chart data
                PrepareChartData();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading rector analytics: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }

    private async Task LoadTrendData()
    {
        trendData = await AnalyticsService.GetUniversityTrendsAsync(selectedMonthRange);

        // Prepare trend chart data
        studentsTrendData = trendData.MonthlyData.Select(m => new SmuLineChart.ChartDataPoint
        {
            Date = m.Date,
            Value = m.TotalGrades // Using grades as proxy for student activity
        }).ToList();

        averageGradeTrendData = trendData.MonthlyData.Select(m => new SmuLineChart.ChartDataPoint
        {
            Date = m.Date,
            Value = m.AverageGrade
        }).ToList();

        passRateTrendData = trendData.MonthlyData.Select(m => new SmuLineChart.ChartDataPoint
        {
            Date = m.Date,
            Value = m.PassRate
        }).ToList();
    }

    private void PrepareChartData()
    {
        // Faculty Average Bar Chart
        facultyAverageChartData = facultyComparisons.Select(f => new SmuBarChart.ChartDataItem
        {
            Label = f.FacultyCode,
            Value = f.AverageGrade
        }).ToList();

        // Student Distribution Donut Chart
        studentDistributionData = facultyComparisons.Select(f => new SmuDonutChart.ChartDataSegment
        {
            Label = f.FacultyCode,
            Value = f.StudentCount,
            Color = null // Use default colors
        }).ToList();

        // Faculty Metrics Radar Chart (Multi-metric comparison)
        // We'll show average metrics across all faculties
        if (facultyComparisons.Any())
        {
            facultyMetricsData = new List<SmuRadarChart.ChartDataCategory>
            {
                new() { Category = "Media Note", Value = facultyComparisons.Average(f => f.AverageGrade) },
                new() { Category = "Rata Promovare", Value = facultyComparisons.Average(f => f.PassRate) / 10 }, // Scale to 0-10
                new() { Category = "Studenti/Facultate", Value = (decimal)facultyComparisons.Average(f => f.StudentCount) / 100 }, // Scale to 0-10
                new() { Category = "Performanta", Value = facultyComparisons.Average(f => (f.AverageGrade + f.PassRate / 10) / 2) }
            };
        }
    }

    private List<FacultyComparisonDto> GetSortedFaculties()
    {
        var sorted = facultyComparisons.AsEnumerable();

        sorted = sortColumn switch
        {
            "name" => sortAscending ? sorted.OrderBy(f => f.FacultyName) : sorted.OrderByDescending(f => f.FacultyName),
            "students" => sortAscending ? sorted.OrderBy(f => f.StudentCount) : sorted.OrderByDescending(f => f.StudentCount),
            "professors" => sortAscending ? sorted.OrderBy(f => GetProfessorCount(f.FacultyCode)) : sorted.OrderByDescending(f => GetProfessorCount(f.FacultyCode)),
            "average" => sortAscending ? sorted.OrderBy(f => f.AverageGrade) : sorted.OrderByDescending(f => f.AverageGrade),
            "passrate" => sortAscending ? sorted.OrderBy(f => f.PassRate) : sorted.OrderByDescending(f => f.PassRate),
            _ => sorted.OrderByDescending(f => f.StudentCount)
        };

        return sorted.ToList();
    }

    private void SortBy(string column)
    {
        if (sortColumn == column)
        {
            sortAscending = !sortAscending;
        }
        else
        {
            sortColumn = column;
            sortAscending = false;
        }
    }

    private int GetProfessorCount(string facultyCode)
    {
        // Demo calculation: proportional to students
        var faculty = facultyComparisons.FirstOrDefault(f => f.FacultyCode == facultyCode);
        return faculty != null ? (int)(faculty.StudentCount * 0.08) : 0; // ~8% ratio
    }

    private BadgeStyle GetGradeBadgeStyle(decimal grade)
    {
        return grade switch
        {
            >= 9.0m => BadgeStyle.Success,
            >= 8.0m => BadgeStyle.Info,
            >= 7.0m => BadgeStyle.Warning,
            _ => BadgeStyle.Danger
        };
    }

    private BadgeStyle GetPassRateBadgeStyle(decimal rate)
    {
        return rate switch
        {
            >= 90 => BadgeStyle.Success,
            >= 80 => BadgeStyle.Info,
            >= 70 => BadgeStyle.Warning,
            _ => BadgeStyle.Danger
        };
    }

    private async Task ExportToPdf()
    {
        // Placeholder for PDF export functionality
        // This would use QuestPDF to generate a comprehensive report
        await Task.Delay(100);
        // TODO: Implement PDF generation with university KPIs, charts, and table
    }
}
